<ngx-spinner
  bdColor="rgba(51,51,51,0.8)"
  size="medium"
  color="#ccc"
  type="ball-spin">
  <p style="font-size: 16px; color: #ccc" translate>componente-ngx-spinner.grabando</p>
</ngx-spinner>

<!-- *************** LISTADO ************************************ -->
<div *ngIf="accionForm=='listado' && grilla!==undefined">

    <div class="row tituloRow">
        <div class="col-lg-12 col-12">        
            <span class="tituloTexto">
                <b>{{'moduloRutas.rutas' | translate}}</b>
            </span>                
        </div>
    </div>

    <div translate>{{errorMensaje}}</div>
     
    <div widget class="card border-0 box-shadow" >
        <div class="card-header transparent border-0 text-muted">
            <!-- <h5 class="mb-0" translate>moduloRutas.rutas</h5> -->
            <div class="widget-controls"> 
                <a data-widgster="expand" href="#" class="transition"><i class="fa fa-chevron-down"></i></a>
            </div>        
        </div>
        <div class="card-body pt-0 widget-body"> 

            <div  class="row" >
                <div class="col-12">
                    <table class="table table-hover table-bordered" 
                          [ngClass]="!grilla.verFiltrosAdicionales ? 'Grilla1FilaFiltros' : 'Grilla2FilaFiltros'">

                        <thead>

                            <!--------------- Filtros -------------------->
                            <tr> 
                                <th *ngIf="tipoPerfilUsuario=='Desarrollador' && grilla.verColumnaKey">
                                    <input [(ngModel)]="grilla.filtros['key']" *ngIf="grilla.mostrarFiltro('key')"
                                           type="text" class="form-control filtroGrilla" 
                                           placeholder="{{'moduloDesarrolladores.key' | translate}}">
                                </th>
                                <th *ngIf="tipoPerfilUsuario=='Desarrollador' && !grilla.verColumnaKey"
                                    colspan="1" style="width:24px; padding-left:0px; padding-right:0px;"></th>

                                <th *ngIf="['Desarrollador','Supervisor','Distribuidor'].indexOf(tipoPerfilUsuario)!=-1">
                                    <lib-shared-search-autocomplete 
                                        id="filtro_organizacionKNAI.key"
                                        [value]="grilla.filtros['organizacionKNAI.key']"
                                        [nameField]="'nombre'" 
                                        [nombreColeccion]="'Organizaciones'" 
                                        [inputStyle]="grilla.filtrosStyle['organizacionKNAI.key']" 
                                        [placeholder]="'moduloOrganizaciones.organizacion'"
                                        [whereArray]="[]" 
                                        [orderByArray]="[]" 
                                        [bdFieldName]="'nombre'" 
                                        [organizacionKNAI]="organizacionKNAI"     
                                        [tipoPerfilUsuario]="tipoPerfilUsuario"    
                                        [accionForm]="accionForm"      
                                        [usuarioKANE]="usuarioKANE"     
                                        (cargoSearchAutocomplete)="EmitCargoSearchAutocompleteFiltro('organizacionKNAI.key','key', $event)"></lib-shared-search-autocomplete> 
                                </th> 
                                        
                                <th>
                                    <input [(ngModel)]="grilla.filtros['codigo']" *ngIf="grilla.mostrarFiltro('codigo')" 
                                           (keyup)="filtrarGrilla('codigo')"                                    
                                           type="text" class="form-control filtroGrilla" style="min-width:60px;"
                                           placeholder="{{'claseFicha.codigo' | translate}}">
                                </th>                                     
                                
                                <th>
                                    <lib-shared-search-autocomplete 
                                        id="filtro_nombre"
                                        [value]="grilla.filtros['nombre']"
                                        [nameField]="'nombre'" 
                                        [nombreColeccion]="'Rutas'" 
                                        [inputStyle]="grilla.filtrosStyle['nombre']" 
                                        [placeholder]="'claseFicha.nombre'"
                                        [whereArray]="[]" 
                                        [orderByArray]="[]" 
                                        [bdFieldName]="'nombre'" 
                                        [organizacionKNAI]="organizacionKNAI"     
                                        [tipoPerfilUsuario]="tipoPerfilUsuario"     
                                        [accionForm]="accionForm"     
                                        [usuarioKANE]="usuarioKANE"     
                                        (cargoSearchAutocomplete)="EmitCargoSearchAutocompleteFiltro('nombre','nombre', $event)"></lib-shared-search-autocomplete> 
                                </th>
                                
                                <th>
                                    <select [(ngModel)]="grilla.filtros['vehiculoPrincipalKN.key']" *ngIf="grilla.mostrarFiltro('vehiculoPrincipalKN.key')"
                                            id="filtro_vehiculoPrincipalKN.key" 
                                            class="form-control filtroGrilla selectpicker"
                                            style="min-width:100px;"
                                            [ngStyle]="grilla.filtrosStyle['vehiculoPrincipalKN.key']"
                                            [ngClass]="grilla.filtros['vehiculoPrincipalKN.key'] ? 'filtroConValor' : 'filtroSinValor'"
                                            (change)="filtrarGrilla('vehiculoPrincipalKN.key')">                                       
                                       <option [ngValue]="null">{{'moduloRutas.vehiculo' | translate}}</option>                                                             
                                       <ng-container *ngFor="let opcion of msg.cacheColecciones['AuxVehiculos']">    
                                            <option [ngValue]="opcion.key"> {{opcion.nombre | translate}}</option>
                                       </ng-container>            
                                    </select>            
                                </th> 

                                <th>
                                    <lib-shared-search-autocomplete 
                                        id="filtro_integranteChoferKANE.key"
                                        [value]="grilla.filtros['integranteChoferKANE.key']"
                                        [nameField]="'datosPersonales.apellidoNombre'" 
                                        [nombreColeccion]="'Usuarios'" 
                                        [inputStyle]="grilla.filtrosStyle['integranteChoferKANE.key']" 
                                        [placeholder]="'moduloRutas.chofer'"
                                        [whereArray]="[]" 
                                        [orderByArray]="[]" 
                                        [bdFieldName]="'datosPersonales.apellidoNombre'" 
                                        [organizacionKNAI]="organizacionKNAI"     
                                        [tipoPerfilUsuario]="tipoPerfilUsuario"     
                                        [accionForm]="accionForm"     
                                        [usuarioKANE]="usuarioKANE"     
                                        (cargoSearchAutocomplete)="EmitCargoSearchAutocompleteFiltro('integranteChoferKANE.key','key',$event)"></lib-shared-search-autocomplete> 
                                </th> 

                                <th>
                                    <select [(ngModel)]="grilla.filtros['estadoRutaKN.key']" *ngIf="grilla.mostrarFiltro('estadoRutaKN.key')"
                                            id="filtro_estadoRutaKN.key" 
                                            class="form-control filtroGrilla selectpicker"
                                            style="min-width:100px;"
                                            [ngStyle]="grilla.filtrosStyle['estadoRutaKN.key']"
                                            [ngClass]="grilla.filtros['estadoRutaKN.key'] ? 'filtroConValor' : 'filtroSinValor'"
                                            (change)="filtrarGrilla('estadoRutaKN.key')">                                       
                                       <option [ngValue]="null">{{'claseFicha.estado' | translate}}</option>                                                             
                                       <ng-container *ngFor="let opcion of msg.cacheColecciones['AuxEstadosRutas']">    
                                            <option [ngValue]="opcion.key"> {{opcion.nombre | translate}}</option>
                                       </ng-container>            
                                    </select>            
                                </th> 
                                
                                <th>
                                    <input type="text" [owlDateTime]="filtro_fechaHoraInicioPlaneada" 
                                        id="filtro_fechaHoraInicioPlaneada" 
                                        class="form-control filtroGrilla" 
                                        placeholder="{{'claseDateTime.periodo' | translate}}" 
                                        style="background:white;" 
                                        [owlDateTimeTrigger]="filtro_fechaHoraInicioPlaneada"
                                        [selectMode]="'range'" READONLY>  
                                    <owl-date-time #filtro_fechaHoraInicioPlaneada 
                                        pickerType="calendar"
                                        (afterPickerClosed)="closeFilterRangoFechas('fechaHoraInicioPlaneada','filtro_fechaHoraInicioPlaneada')"></owl-date-time>                                    
                                </th> 

                                <th></th> 
                                
                                <th class="align-middle" style="padding-top:0px; padding-bottom:0px;">
                                    <button title="{{'navegabilidad.reset' | translate}}"
                                            class="btn btn-link btn-lg"
                                            (click)="resetFiltros()"><i class="fa fa-eraser ml-3 text-secondary"></i></button>
                                </th>

                            </tr>

                            <!-- Títulos de Columnas -->
                            <tr class="titulo-grilla"> 

                                <th *ngIf="tipoPerfilUsuario=='Desarrollador' && grilla.verColumnaKey"                                    
                                    [class.active]="grilla.orderField === 'key'"
                                    (click)="onChangeGrilla('order','key')" style="padding-bottom:0px;">

                                        <button class="btn btn-link btn-lg"  
                                            style="padding-left:0px; padding-top:0px; margin-right:30px;"
                                            title="{{'grilla.ocultarKey' | translate}}" 
                                            *ngIf="permisos.altasAutorizadas" 
                                            (click)="grilla.verColumnaKey=!grilla.verColumnaKey"><i class="mdi mdi-unfold-less-vertical mdi-24px text-dark"
                                           aria-hidden="true"></i></button>

                                        {{'moduloDesarrolladores.key' | translate}}<span [hidden]="grilla.orderReverse">▼</span><span [hidden]="!grilla.orderReverse">▲</span>
                                </th>
                                <th *ngIf="tipoPerfilUsuario=='Desarrollador' && !grilla.verColumnaKey"
                                 (click)="grilla.verColumnaKey=!grilla.verColumnaKey" title="{{'grilla.mostrarKey' | translate}}"
                                        colspan="1"
                                        style="width:10px; padding-left:0px; padding-right:0px; text-align:center;">
                                    ...
                                </th>
                                
                                <th *ngIf="['Desarrollador','Supervisor','Distribuidor'].indexOf(tipoPerfilUsuario)!=-1"
                                    translate>moduloOrganizaciones.organizacion</th> 

                                <th [class.active]="grilla.orderField === 'nombre'" [attr.colspan]="2"
                                    class="text-left"
                                    (click)="onChangeGrilla('order','nombre')"
                                    translate>claseFicha.nombre<span [hidden]="grilla.orderReverse">▼</span><span [hidden]="!grilla.orderReverse">▲</span>
                                </th> 
                                
                                <th [class.active]="grilla.orderField === 'vehiculoPrincipalKN.key'" class="text-left" colspan="2"
                                    (click)="onChangeGrilla('order','vehiculoPrincipalKN.key')" translate>moduloRutas.vehiculo<b> / </b><b>{{'moduloRutas.chofer' | translate}}</b><span [hidden]="grilla.orderReverse">▼</span><span [hidden]="!grilla.orderReverse">▲</span>
                                </th>                                 

                                <th [class.active]="grilla.orderField === 'estadoRutaKN.nombre'" class="text-left" 
                                    (click)="onChangeGrilla('order','estadoRutaKN.nombre')" translate>claseFicha.estado<span [hidden]="grilla.orderReverse">▼</span><span [hidden]="!grilla.orderReverse">▲</span>
                                </th>                                 
                                
                                <th [class.active]="grilla.orderField === 'grillaFiltrosFechaHoraInicioPlaneada'" class="text-center"
                                    (click)="onChangeGrilla('order','grillaFiltrosFechaHoraInicioPlaneada')" translate>moduloRutas.inicio<span [hidden]="grilla.orderReverse">▼</span><span [hidden]="!grilla.orderReverse">▲</span>
                                </th>                                 

                                <th class="text-center" translate>moduloRutas.finalizacion</th>                                 
                                
                                <th class="align-middle" style="padding-top:0px; padding-bottom:0px;">
                                    <!-- Agregar -->
                                    <button class="btn btn-link btn-lg"  
                                    title="{{'navegabilidad.agregar' | translate}}" 
                                    *ngIf="permisos.altasAutorizadas" (click)="abrirFormulario(null)"><i class="fa fa-plus ml-3 text-success"></i></button>
                                </th>    

                            </tr>

                        </thead>
                        <tbody>

                            <!-- ----------------------------------------------------------------- -->
                            <!-- ------- Orden, Filtros y Paginado ------------------------------- -->
                            <!-- ----------------------------------------------------------------- -->

                            <ng-container *ngFor="let documento of listadoPrincipal 
                                        | orderBy :grilla.orderField :grilla.orderReverse :'case-insensitive'                                        
                                        | searchFiltro:grilla.paginadoTipo:'key':grilla.filtros['key']
                                        | searchFiltro:grilla.paginadoTipo:'organizacionKNAI.key':grilla.filtros['organizacionKNAI.key']                                        
                                        | searchFiltro:grilla.paginadoTipo:'codigo':grilla.filtros['codigo']
                                        | searchFiltro:grilla.paginadoTipo:'nombre':grilla.filtros['nombre']                                                                                
                                        | searchFiltro:grilla.paginadoTipo:'vehiculoPrincipalKN.key':grilla.filtros['vehiculoPrincipalKN.key']
                                        | searchFiltro:grilla.paginadoTipo:'integranteChoferKANE.key':grilla.filtros['integranteChoferKANE.key']   
                                        | searchFiltro:grilla.paginadoTipo:'estadoRutaKN.key':grilla.filtros['estadoRutaKN.key']
                                        | searchFiltro:grilla.paginadoTipo:'fechaHoraInicioPlaneada':grilla.filtros['fechaHoraInicioPlaneada']                                        
                                        | searchFiltro:grilla.paginadoTipo:'settings.borradoFisico':false:'boolean'   
                                        | paginate: { itemsPerPage: grilla.paginadoCantidad, 
                                                      currentPage : pagePaginado,
                                                      totalItems  : grilla.resultCantidad }; 
                                          let index = index"> 

                                 <tr [ngStyle]="grilla.colorFilaSegunEstado(documento.settings)"
                                     (mouseover)="grilla.keyHoverActivo=documento.key"
                                     (mouseout)="grilla.keyHoverActivo=null"              
                                     [ngClass]="grilla.keyHoverActivo==documento.key ? 'trHover' : 'trNotHover'">

                                    <td *ngIf="tipoPerfilUsuario=='Desarrollador' && grilla.verColumnaKey"
                                        class="align-middle"
                                        (click)="abrirFormulario(documento)"> 
                                        <span class="align-left">{{documento.key}}</span>
                                    </td>
                                    <td *ngIf="tipoPerfilUsuario=='Desarrollador' && !grilla.verColumnaKey"
                                        (click)="grilla.verColumnaKey=!grilla.verColumnaKey"
                                        colspan="1"
                                        style="width:12px; padding-left:0px; padding-right:0px;"></td>

                                    <td class="align-middle" (click)="abrirFormulario(documento)"
                                        *ngIf="['Desarrollador','Supervisor','Distribuidor'].indexOf(tipoPerfilUsuario)!=-1">
                                        <span [ngClass]="documento.settings.isActivo ? 'spanGrillaResaltadoActivo' : 'spanGrillaResaltadoNoActivo'"
                                              class="align-middle text-truncate">{{fn.mostrarKN(documento.organizacionKNAI,'nombre')}}</span><BR>
                                        {{fn.mostrarKN(documento.sucursalKN,'nombre')}} / {{fn.mostrarKN(documento.areaNegocioKN,'nombre')}}
                                    </td>    
                                        
                                    <td class="align-middle" (click)="abrirFormulario(documento)" [attr.colspan]="2"> 
                                        <span [ngClass]="documento.settings.isActivo ? 'spanGrillaResaltadoActivo' : 'spanGrillaResaltadoNoActivo'"
                                              class="align-middle">{{documento.nombre}} <span *ngIf="documento.codigo">({{documento.codigo}})</span></span><br>
                                        <span *ngIf="documento.distanciaPlanificada">{{documento.distanciaPlanificada | number : '1.2-2'}} Kms</span>
                                    </td>    

                                    <td class="align-middle" (click)="abrirFormulario(documento)" [attr.colspan]="2">
                                        <span *ngIf="documento.vehiculoPrincipalKN"
                                              [ngClass]="documento.settings.isActivo ? 'spanGrillaResaltadoActivo' : 'spanGrillaResaltadoNoActivo'"
                                              class="align-middle">{{fn.mostrarKN(documento.vehiculoPrincipalKN,'nombre')}}<br></span>                          
                                        <span class="align-middle">{{fn.mostrarKANE(documento.integranteChoferKANE,'apellidoNombre')}}</span>                          
                                    </td>    

                                    <td class="align-middle" (click)="abrirFormulario(documento)" translate>
                                        {{fn.mostrarKN(documento.estadoRutaKN,'nombre')}}
                                    </td>    
                                    
                                    <td class="align-middle text-center" (click)="abrirFormulario(documento)">
                                        <span [ngClass]="documento.settings.isActivo ? 'spanGrillaResaltadoActivo' : 'spanGrillaResaltadoNoActivo'"
                                              class="align-middle">{{documento.fechaHoraInicioPlaneada | date:'DD/MM/AAAA':activeLang}}</span><br>
                                        <span class="align-middle">{{documento.fechaHoraInicioPlaneada | date:'HH:MM hs':activeLang}}</span>                          
                                    </td>    

                                    <td class="align-middle text-center" (click)="abrirFormulario(documento)">
                                        <span [ngClass]="documento.settings.isActivo ? 'spanGrillaResaltadoActivo' : 'spanGrillaResaltadoNoActivo'"
                                              class="align-middle">{{documento.fechaHoraFinalizacionPlaneada | date:'DD/MM/AAAA':activeLang}}</span><br>
                                        <span class="align-middle">{{documento.fechaHoraFinalizacionPlaneada | date:'HH:MM hs':activeLang}}</span>                          
                                    </td>    
                                                                        
                                    <td class="align-middle">
                                        <div class="btn-group" role="group">
                                            <button class="btn btn-link btn-lg" style="padding-left:0px; padding-right:0px;"
                                                    title="{{'navegabilidad.consultar' | translate}}"
                                                    (click)="abrirFormulario(documento)"><i class="fa fa-search mr-3 text-primary"></i></button>

                                            <!-- borrado lógico -->
                                            <button *ngIf="permisos.bajasAutorizadas &&
                                                    documento.settings.documentosAsociados==0 && documento.settings.isBorrado==false" 
                                                    title="{{'navegabilidad.eliminar' | translate}}"
                                                    class="btn btn-link btn-lg"  style="padding-left:0px; padding-right:0px;"
                                                    (click)="deleteDocumento('borradoLogico', documento)"><i class="fa fa-trash mr-3 text-danger"></i></button>

                                            <button *ngIf="permisos.bajasAutorizadas &&
                                                    documento.settings.documentosAsociados>0 && documento.settings.isBorrado==false" 
                                                    title="{{fn.titleMensaje('claseValidaciones.documentosAsociados',documento.settings.documentosAsociados)}}"
                                                    class="btn btn-link btn-lg"  style="padding-left:0px; padding-right:0px;"
                                                    (click)="fn.alertMensaje('claseValidaciones.documentosAsociados',documento.settings.documentosAsociados)"><i class="fa fa-trash mr-3 text-deshabilitado"></i></button>

                                            <!-- borrado físico -->
                                            <button *ngIf="permisos.bajasAutorizadas && documento.settings.isBorrado &&
                                                          ['Desarrollador','Supervisor','Distribuidor'].indexOf(tipoPerfilUsuario)!=-1"
                                                    title="{{'navegabilidad.eliminarFisicamente' | translate}}"
                                                    class="btn btn-link btn-lg" style="padding-left:0px; padding-right:0px;"
                                                    (click)="deleteDocumento('borradoFisico',documento)"><i class="fa fa-remove mr-3 text-danger"></i></button>

                                        </div>
                                    </td>
                                </tr>

                            </ng-container>

                        </tbody>
                    </table>

                    <!-- paginado -->
                    <div class="row" style="border-top:1px solid #ccc;">
                        <div class="col-3" style="padding:10px;">
                            <div class="bg-white text-center">
                                <select class="form-control selectpicker" 
                                        id="grilla.paginadoCantidad"                                         
                                        [(ngModel)]="grilla.paginadoCantidad"
                                        (change)="onChangeGrilla('paginadoCantidad',grilla.paginadoCantidad)"> 
                                    <ng-container *ngFor="let opcion of grilla.paginadoDropDown">
                                        <option [ngValue]="opcion">Items x Página {{opcion}}</option>
                                    </ng-container>
                                </select>
                            </div>    
                        </div>    
                        <div class="col-9" style="padding:10px;">
                            <div class="bg-white text-center">

                                <!-- Paginado Local -->
                                <pagination-controls 
                                    *ngIf="grilla.paginadoTipo=='local'"
                                    autoHide="{{grilla.paginadoAutoHide}}" 
                                    previousLabel="{{'componente-paginado.anterior' | translate}}" 
                                    nextLabel="{{'componente-paginado.siguiente' | translate}}" 
                                    (pageChange)="pagePaginado = $event" 
                                    maxSize="3"></pagination-controls>

                                <!-- Paginado Servidor -->
                                <lib-shared-paginado-servidor 
                                    *ngIf="grilla.paginadoTipo=='servidor'"
                                    [grilla]="grilla" 
                                    (clickPaginado)="emitClickPaginado($event)"></lib-shared-paginado-servidor>

                            </div>
                        </div>                        
                    </div>

                </div>
            </div>

        </div> <!-- FIN card-body -->
    </div> <!-- FIN widget -->

</div>

<!-- *************** FORMULARIO ************************************ -->
<div *ngIf="['agregar','modificar','consultar'].indexOf(accionForm)!=-1 && form.value">
    
    <div class="row tituloRow">
        <div class="col-lg-12 col-12">        
            <span class="tituloTexto">
                <b>{{'moduloRutas.ruta' | translate}}: </b>
                {{form.value.nombre}} <span *ngIf="form.value.codigo">({{form.value.codigo}})</span>
            </span>                
            <button type="button" 
                *ngIf="['modificar','agregar'].indexOf(accionForm)==-1 &&
                       router.url!='/usuarios/fichaOrganizacion'"
                class="btn btn-warning tituloButton" 
                (click)="setAccionForm('listado')" translate>navegabilidad.salir</button>

        </div>
    </div>
    
    <div class="row">
        <div class="col-lg-12 col-12">

            <div class="clearfix">            
                <ul class="nav nav-tabs">
                    <li class="nav-item">
                        <a class="nav-link active" data-toggle="tab" 
                           href="#panelFicha" id="tabFicha" 
                           translate>claseTabs.ficha</a>
                    </li>

                    <!-- Solapas Activas cuando no estoy editando Ficha -->
                    <li class="nav-item" *ngIf="form.value.key && ['modificar','agregar'].indexOf(accionForm)==-1">
                        <a class="nav-link" data-toggle="tab" 
                           href="#panelVehiculos" id="tabVehiculos" 
                           (click)="clickSolapa('#tabVehiculos')" 
                           translate>moduloRutas.vehiculos</a>
                    </li>
                    <li class="nav-item" *ngIf="form.value.key && ['modificar','agregar'].indexOf(accionForm)==-1">
                        <a class="nav-link" data-toggle="tab" 
                           href="#panelIntegrantes" id="tabIntegrantes"
                           (click)="clickSolapa('#tabIntegrantes')"  
                           translate>moduloRutas.integrantes</a>
                    </li>
                    <li class="nav-item" *ngIf="form.value.key && ['modificar','agregar'].indexOf(accionForm)==-1">
                        <a class="nav-link" data-toggle="tab" 
                           href="#panelParadas" id="tabParadas" 
                           (click)="clickSolapa('#tabParadas')" 
                           translate>moduloRutas.paradas</a>
                    </li>
                    <li class="nav-item" *ngIf="form.value.key && ['modificar','agregar'].indexOf(accionForm)==-1 && listadoRutaParadas.length>1">
                        <a class="nav-link" data-toggle="tab" 
                           href="#panelRecorrido" id="tabRecorrido" 
                           (click)="clickSolapa('#tabRecorrido')" 
                           translate>moduloRutas.recorrido</a>
                    </li>

                    <!-- Solapas Deshabilitadas -->
                    <li class="nav-item" *ngIf="form.value.key && ['modificar','agregar'].indexOf(accionForm)!=-1">
                        <a class="nav-link" 
                           href="javascript:;" translate>moduloRutas.vehiculos</a>
                    </li>
                    <li class="nav-item" *ngIf="form.value.key && ['modificar','agregar'].indexOf(accionForm)!=-1">
                        <a class="nav-link" 
                           href="javascript:;" translate>moduloRutas.integrantes</a>
                    </li>
                    <li class="nav-item" *ngIf="form.value.key && ['modificar','agregar'].indexOf(accionForm)!=-1">
                        <a class="nav-link" 
                           href="javascript:;" translate>moduloRutas.rutas</a>
                    </li>

                </ul>
            </div>
            <div class="tab-content top">

                <div class="tab-pane active" id="panelFicha" style="padding-top:0px; padding-bottom:0px;">
                    
                        <div class="row" style="margin-bottom:0px;">
                        <div class="col-xl-9 mb-9">
                                            
                                    <!-- ******************** FICHA ********************* -->    
                                    <form [formGroup]="form" (ngSubmit)="onSubmit(form.value)" style="padding-top:10px; padding-bottom:10px;">

                                        <lib-shared-form-buttons [accionForm]='accionForm'
                                                          [permisos]='permisos' 
                                                          (setAccion)="setAccionForm($event)"
                                                          (onSubmitComponent)="onSubmit(form.value)"></lib-shared-form-buttons>

                                        <!-- ********* datos generales ********** -->
                                        <div widget class="card border-0 box-shadow" style="margin-top:10px;">
                                            <div class="card-header transparent border-0 text-muted">
                                                <h5 class="mb-0" translate>claseTabs.basic</h5>
                                                <div class="widget-controls"> 
                                                     <a data-widgster="expand" href="#" class="transition"><i class="fa fa-chevron-down"></i></a>
                                                    <a data-widgster="collapse" href="#" class="transition"><i class="fa fa-chevron-up"></i></a>                                     
                                                </div>        
                                            </div>
                                            <div class="card-body pt-0 widget-body"> 
                                                
                                                <div class="row">
                                                    
                                                    <div class="col-4">

                                                            <!-- Código -->
                                                            <div class="form-group">
                                                                <label class="text-gray" translate>claseFicha.codigo<span class="required">*</span></label>
                                                                <input formControlName="codigo" class="form-control validation-field" type="text">
                                                                <small class="text-danger" *ngIf="form.controls.codigo.touched && form.controls.codigo.errors?.required"><span translate>claseFicha.codigo</span>&nbsp;<span translate>claseValidaciones.esRequerido</span></small>                              
                                                            </div>                                                                        

                                                            <!-- Organización -->
                                                            <div class="form-group">
                                                                <label class="text-gray" translate>moduloOrganizaciones.organizacion<span class="required">*</span></label>                                            
                                                                <input *ngIf="form.value.organizacionKNAI===undefined || (form.value.organizacionKNAI!==undefined && ['Desarrollador','Supervisor','Distribuidor'].indexOf(tipoPerfilUsuario)==-1)" 
                                                                       value="{{fn.mostrarKN(form.controls.organizacionKNAI.value,'nombre')}}" 
                                                                       class="form-control validation-field" 
                                                                       style="height:35px; font-weight:bold; font-size:11px; color:black;"
                                                                       type="text" readonly> 
                                                                <lib-shared-search-autocomplete 
                                                                    *ngIf="form.value.organizacionKNAI!==undefined && ['Desarrollador','Supervisor','Distribuidor'].indexOf(tipoPerfilUsuario)!=-1"
                                                                    id="form_organizacionKNAI"
                                                                    [value]="form.value.organizacionKNAI"
                                                                    [nameField]="'nombre'" 
                                                                    [nombreColeccion]="'Organizaciones'" 
                                                                    [inputStyle]="{}" 
                                                                    [placeholder]="'moduloOrganizaciones.organizacion'"
                                                                    [whereArray]="[]" 
                                                                    [orderByArray]="[]" 
                                                                    [bdFieldName]="'nombre'" 
                                                                    [organizacionKNAI]="organizacionKNAI"     
                                                                    [tipoPerfilUsuario]="tipoPerfilUsuario"     
                                                                    [accionForm]="accionForm"     
                                                                    [usuarioKANE]="usuarioKANE"     
                                                                    (cargoSearchAutocomplete)="EmitCargoSearchAutocompleteForm('organizacionKNAI','KNAI', $event)"></lib-shared-search-autocomplete>                                     
                                                                <small class="text-danger" 
                                                                        *ngIf="form.controls.organizacionKNAI.touched && 
                                                                               form.controls.organizacionKNAI.errors?.required"><span translate>moduloOrganizaciones.organizacion</span>&nbsp;<span translate>claseValidaciones.esRequerido</span></small>
                                                                        <!-- *ngIf="form.value.organizacion!=null ||-->
                                                            </div>            
                                                            
                                                    </div>
                                                    
                                                    <div class="col-4">
                                                        
                                                            <!-- Nombre -->
                                                            <div class="form-group">
                                                                <label class="text-gray" translate>claseFicha.nombre<span class="required">*</span></label>
                                                                <input formControlName="nombre" class="form-control validation-field" type="text">
                                                                <small class="text-danger" *ngIf="form.controls.nombre.touched && form.controls.nombre.errors?.required"><span translate>claseFicha.nombre</span>&nbsp;<span translate>claseValidaciones.esRequerido</span></small>                              
                                                            </div>

                                                            <!-- Sucursal -->
                                                            <div class="form-group">
                                                                <label class="text-gray" translate>moduloOrganizaciones.sucursal<span class="required">*</span></label>                                            
                                                                <select class="form-control selectpicker validation-field" 
                                                                        id="sucursalKN" formControlName="sucursalKN" [compareWith]="compareFn">
                                                                    <option *ngIf="listadoSucursales.length>1"
                                                                            [ngValue]="null">{{'No Indicado' | translate}}</option>                                  
                                                                    <ng-container *ngFor="let option of listadoSucursales">
                                                                        <option [ngValue]="option">{{option.nombre | translate}}</option>
                                                                    </ng-container>
                                                                </select>
                                                                <small class="text-danger" 
                                                                        *ngIf="form.controls.sucursalKN.touched && 
                                                                               form.controls.sucursalKN.errors?.required"><span translate>moduloOrganizaciones.sucursal</span>&nbsp;<span translate>claseValidaciones.esRequerido</span></small>
                                                            </div>  

                                                    </div>                                                        
                                                    <div class="col-4">

                                                            <!-- Fecha/Hora de Carga -->
                                                            <div class="form-group">
                                                                <label class="text-gray" translate>claseDateTime.fechaHora <span translate>moduloRutas.carga</span><span class="required">*</span></label>
                                                                <div class="input-group">
                                                                    <input [owlDateTime]="fechaHoraCarga" 
                                                                           id="fechaHoraCarga" 
                                                                           formControlName="fechaHoraCarga" 
                                                                           class="form-control validation-field" type="text" placeholder="">
                                                                    <div class="input-group-append">
                                                                        <span [owlDateTimeTrigger]="fechaHoraCarga" 
                                                                        class="input-group-text"><i class="fa fa-calendar"></i></span>
                                                                    </div>
                                                                    <owl-date-time #fechaHoraCarga 
                                                                        (afterPickerClosed)="closeDateTimePicker('fechaHoraCarga',form.value.fechaHoraCarga)">
                                                                    </owl-date-time>
                                                                </div>
                                                                <small *ngIf="form.controls.fechaHoraCarga.touched && 
                                                                              form.controls.fechaHoraCarga.errors?.required" class="text-danger"><span translate>moduloDateTime.fechaHora</span>&nbsp;<span translate>moduloRutas.carga</span><span translate>claseValidaciones.esRequerido</span></small>
                                                            </div>                                                            
                                                            
                                                            <!-- Areas de Negocio -->
                                                            <div class="form-group">
                                                                <label class="text-gray" translate>moduloOrganizaciones.areaNegocio<span class="required">*</span></label>                                            
                                                                <select class="form-control selectpicker validation-field" 
                                                                        id="areaNegocioKN" formControlName="areaNegocioKN" [compareWith]="compareFn">
                                                                    <option *ngIf="listadoAreasNegocio.length>1"
                                                                            [ngValue]="null">{{'No Indicado' | translate}}</option>                                  
                                                                    <ng-container *ngFor="let option of listadoAreasNegocio">
                                                                        <option [ngValue]="option">{{option.nombre | translate}}</option>
                                                                    </ng-container>
                                                                </select>
                                                                <small class="text-danger" 
                                                                        *ngIf="form.controls.areaNegocioKN.touched && 
                                                                               form.controls.areaNegocioKN.errors?.required"><span translate>moduloOrganizaciones.areaNegocio</span>&nbsp;<span translate>claseValidaciones.esRequerido</span></small>
                                                            </div>  
                                                            
                                                        
                                                    </div>                                                        
                                                        
                                                </div>        
                                                    
                                                <div class="row">
                                                    
                                                    <div class="col-6">

                                                            <!-- Origen -->                                                        
                                                            <div class="form-group">
                                                                <label class="text-gray" translate>moduloRutas.origen</label>
                                                                <div class="input-group" style="padding-left:0px;">
                                                                    <input id="rutaOrigen" 
                                                                           [value]="fn.mostrarKN(form.value.ubicacionOrigenKN,'nombre')"
                                                                           class="form-control" readonly>
                                                                    <div class="input-group-append">
                                                                        <select formControlName="origenEsDestino" id="origenEsDestino" 
                                                                                class="form-control selectpicker validation-field"
                                                                                style="height:34px; font-size:10px; padding-left:2px; padding-right:2px;"
                                                                                (change)="onChangeRutaEsDestino()">                                       
                                                                           <option [ngValue]="false" translate>moduloRutas.iniciaAqui</option>                                                             
                                                                           <option [ngValue]="true" translate>moduloRutas.finalizaAqui</option>                                                             
                                                                        </select>            
                                                                    </div>
                                                                </div>
                                                            </div>

                                                            <div class="row">
                                                                <div class="col-6">
                                                                    <!-- Forma de Carga -->
                                                                    <div class="form-group">
                                                                        <label class="text-gray" translate>moduloRutas.formaCarga</label>
                                                                        <select formControlName="formaCarga" id="formaCarga" 
                                                                                class="form-control selectpicker validation-field">                                       
                                                                           <option [ngValue]="'calculaHorarios'" translate>moduloRutas.calculaHorarios</option>                                                             
                                                                           <option [ngValue]="'ingresaHorarios'" translate>moduloRutas.ingresaHorarios</option>                                                             
                                                                        </select>            
                                                                    </div>                                                                        
                                                                </div>
                                                                <div class="col-6">
                                                                    <!-- Distancia Planificada -->
                                                                    <div class="form-group">
                                                                        <label class="text-gray" translate>moduloRutas.distanciaPlanificada</label>
                                                                        <div class="input-group" style="padding-left:0px;">
                                                                            <input formControlName="distanciaPlanificada"  id="distanciaPlanificada"                                                                 
                                                                                   mask="separator.2" thousandSeparator="."
                                                                                   class="form-control" style="width:150px;" readonly>
                                                                                <div class="input-group-append">
                                                                                <span class="input-group-text">kms</span>
                                                                            </div>
                                                                        </div>                                                                                            
                                                                    </div>                                                                    
                                                                </div>                                                                
                                                            </div>
                                                            
                                                    </div>
                                                    
                                                    <div class="col-6">

                                                            <!-- Destino -->
                                                            <div class="form-group">
                                                                <label class="text-gray" translate>moduloRutas.destino</label>
                                                                <input id="rutaDestino" 
                                                                       [value]="form.value.origenEsDestino ? fn.mostrarKN(form.value.ubicacionOrigenKN,'nombre') : fn.mostrarKN(form.value.ubicacionDestinoKN,'nombre')"
                                                                       class="form-control" readonly>
                                                            </div>

                                                            <div class="row">
                                                                <div class="col-6">
                                                                        <!-- Costo Planificado -->
                                                                        <div class="form-group">
                                                                            <label class="text-gray" translate>moduloRutas.costoPlanificado</label>
                                                                            <input formControlName="costoPlanificado"  id="costoPlanificado" 
                                                                                   prefix="$ " mask="separator.2" thousandSeparator="."
                                                                            class="form-control">
                                                                        </div>                                                                                                                                
                                                                </div>
                                                                <div class="col-6">
                                                                        <!-- Estado -->                                                                        
                                                                        <label class="text-gray" translate>moduloRutas.estadoRuta</label>
                                                                        <select formControlName="estadoRutaKN"
                                                                                id="estadoRutaKN" 
                                                                                class="form-control selectpicker validation-field" 
                                                                                [compareWith]="compareFn">                                       
                                                                           <ng-container *ngFor="let opcion of msg.cacheColecciones['AuxEstadosRutas']">    
                                                                                <option [ngValue]="opcion"> {{opcion.nombre | translate}}</option>
                                                                           </ng-container>            
                                                                        </select>  
                                                                </div>
                                                            </div>

                                                    </div>
                                                        
                                                </div>        
                                                
                                            </div> <!-- FIN card-body -->
                                        </div> <!-- FIN widget -->

                                        <!-- ********* salida y llegada planificada ********** -->
                                        <div widget class="card border-0 box-shadow" style="margin-top:10px;">
                                            <div class="card-header transparent border-0 text-muted">
                                                <h5 class="mb-0" translate>moduloRutas.planificado</h5>
                                                <div class="widget-controls"> 
                                                     <a data-widgster="expand" href="#" class="transition"><i class="fa fa-chevron-down"></i></a>
                                                    <a data-widgster="collapse" href="#" class="transition"><i class="fa fa-chevron-up"></i></a>                                     
                                                </div>        
                                            </div>
                                            <div class="card-body pt-0 widget-body"> 
                                                
                                                <div class="row">
                                                    
                                                    <div class="col-6">

                                                            <!-- Fecha/Hora de Inicio -->
                                                            <div class="form-group">
                                                                <label class="text-gray">{{'moduloRutas.origen' | translate}} - {{'claseDateTime.fechaHora' | translate}}<span translate>moduloRutas.inicio</span><span class="required">*</span></label>
                                                                <div class="input-group">
                                                                    <input [owlDateTime]="fechaHoraInicioPlaneada" 
                                                                           id="fechaHoraInicioPlaneada" 
                                                                           formControlName="fechaHoraInicioPlaneada" 
                                                                           class="form-control validation-field" type="text" placeholder="">
                                                                    <div class="input-group-append">
                                                                        <span [owlDateTimeTrigger]="fechaHoraInicioPlaneada" 
                                                                        class="input-group-text"><i class="fa fa-calendar"></i></span>
                                                                    </div>
                                                                    <owl-date-time #fechaHoraInicioPlaneada 
                                                                        (afterPickerClosed)="closeDateTimePicker('fechaHoraInicioPlaneada',form.value.fechaHoraInicioPlaneada)">
                                                                    </owl-date-time>
                                                                </div>
                                                                <small *ngIf="form.controls.fechaHoraInicioPlaneada.touched && 
                                                                              form.controls.fechaHoraInicioPlaneada.errors?.required" 
                                                                       class="text-danger"><span translate>moduloDateTime.fechaHora</span>&nbsp;<span translate>moduloRutas.inicio</span><span translate>claseValidaciones.esRequerido</span></small>
                                                            </div>                                                            

                                                            <!-- Fecha/Hora de Salida -->
                                                            <div class="form-group">
                                                                <label class="text-gray">{{'moduloRutas.origen' | translate}} - {{'claseDateTime.fechaHora' | translate}}<span translate>moduloRutas.salida</span><span class="required">*</span></label>
                                                                <div class="input-group">
                                                                    <input [owlDateTime]="fechaHoraSalidaPlaneada" 
                                                                           id="fechaHoraSalidaPlaneada" 
                                                                           formControlName="fechaHoraSalidaPlaneada" 
                                                                           class="form-control validation-field" type="text" placeholder="">
                                                                    <div class="input-group-append">
                                                                        <span [owlDateTimeTrigger]="fechaHoraSalidaPlaneada" 
                                                                        class="input-group-text"><i class="fa fa-calendar"></i></span>
                                                                    </div>
                                                                    <owl-date-time #fechaHoraSalidaPlaneada 
                                                                        (afterPickerClosed)="closeDateTimePicker('fechaHoraSalidaPlaneada',form.value.fechaHoraSalidaPlaneada)">
                                                                    </owl-date-time>
                                                                </div>
                                                                <small *ngIf="form.controls.fechaHoraSalidaPlaneada.touched && 
                                                                              form.controls.fechaHoraSalidaPlaneada.errors?.required" 
                                                                       class="text-danger"><span translate>moduloDateTime.fechaHora</span>&nbsp;<span translate>moduloRutas.salida</span><span translate>claseValidaciones.esRequerido</span></small>
                                                            </div>                    
                                                    
                                                    </div>
                                                    
                                                    <div class="col-6">

                                                            <!-- Fecha/Hora de Arribo -->
                                                            <div class="form-group">
                                                                <label class="text-gray">{{'moduloRutas.destino' | translate}} - {{'claseDateTime.fechaHora' | translate}} <span translate>moduloRutas.arribo</span><span class="required">*</span></label>
                                                                <div class="input-group">
                                                                    <input [owlDateTime]="fechaHoraArriboPlaneada" 
                                                                           id="fechaHoraArriboPlaneada" 
                                                                           formControlName="fechaHoraArriboPlaneada" 
                                                                           class="form-control validation-field" type="text" placeholder="">
                                                                    <div class="input-group-append">
                                                                        <span [owlDateTimeTrigger]="fechaHoraArriboPlaneada" 
                                                                        class="input-group-text"><i class="fa fa-calendar"></i></span>
                                                                    </div>
                                                                    <owl-date-time #fechaHoraArriboPlaneada 
                                                                        (afterPickerClosed)="closeDateTimePicker('fechaHoraArriboPlaneada',form.value.fechaHoraArriboPlaneada)">
                                                                    </owl-date-time>
                                                                </div>
                                                                <small *ngIf="form.controls.fechaHoraArriboPlaneada.touched && 
                                                                              form.controls.fechaHoraArriboPlaneada.errors?.required" 
                                                                       class="text-danger"><span translate>moduloDateTime.fechaHora</span>&nbsp;<span translate>moduloRutas.arribo</span><span translate>claseValidaciones.esRequerido</span></small>
                                                            </div>                                                            

                                                            <!-- Fecha/Hora de Finalización -->
                                                            <div class="form-group">
                                                                <label class="text-gray">{{'moduloRutas.destino' | translate}} - {{'claseDateTime.fechaHora' | translate}}<span translate>moduloRutas.finalizacion</span><span class="required">*</span></label>
                                                                <div class="input-group">
                                                                    <input [owlDateTime]="fechaHoraFinalizacionPlaneada" 
                                                                           id="fechaHoraFinalizacionPlaneada" 
                                                                           formControlName="fechaHoraFinalizacionPlaneada" 
                                                                           class="form-control validation-field" type="text" placeholder="">
                                                                    <div class="input-group-append">
                                                                        <span [owlDateTimeTrigger]="fechaHoraFinalizacionPlaneada" 
                                                                        class="input-group-text"><i class="fa fa-calendar"></i></span>
                                                                    </div>
                                                                    <owl-date-time #fechaHoraFinalizacionPlaneada 
                                                                        (afterPickerClosed)="closeDateTimePicker('fechaHoraFinalizacionPlaneada',form.value.fechaHoraArriboPlaneada)">
                                                                    </owl-date-time>
                                                                </div>
                                                                <small *ngIf="form.controls.fechaHoraFinalizacionPlaneada.touched && 
                                                                              form.controls.fechaHoraFinalizacionPlaneada.errors?.required" 
                                                                       class="text-danger"><span translate>moduloDateTime.fechaHora</span>&nbsp;<span translate>moduloRutas.finalizacion</span><span translate>claseValidaciones.esRequerido</span></small>
                                                            </div>                                                            
                                                            
                                                    </div>
                                                        
                                                </div>        


                                            </div> <!-- FIN card-body -->
                                        </div> <!-- FIN widget -->

                                        <!-- ********* salida y llegada real ********** -->
                                        <div widget class="card border-0 box-shadow" style="margin-top:10px;">
                                            <div class="card-header transparent border-0 text-muted">
                                                <h5 class="mb-0" translate>moduloRutas.real</h5>
                                                <div class="widget-controls"> 
                                                     <a data-widgster="expand" href="#" class="transition"><i class="fa fa-chevron-down"></i></a>
                                                    <a data-widgster="collapse" href="#" class="transition"><i class="fa fa-chevron-up"></i></a>                                     
                                                </div>        
                                            </div>
                                            <div class="card-body pt-0 widget-body"> 
                                                
                                                <div class="row">
                                                    
                                                    <div class="col-6">

                                                            <!-- Fecha/Hora de Inicio -->
                                                            <div class="form-group">
                                                                <label class="text-gray" translate>claseDateTime.fechaHora <span translate>moduloRutas.inicio</span><span class="required">*</span></label>
                                                                <input formControlName="fechaHoraInicioReal"  id="fechaHoraInicioReal"                                                                 value="xx"
                                                                class="form-control" readonly>
                                                            </div>                                                            

                                                            <!-- Fecha/Hora de Salida -->
                                                            <div class="form-group">
                                                                <label class="text-gray" translate>claseDateTime.fechaHora <span translate>moduloRutas.salida</span><span class="required">*</span></label>
                                                                <input formControlName="fechaHoraSalidaReal"  id="fechaHoraSalidaReal"                                                                 value="xx"
                                                                class="form-control" readonly>
                                                            </div>                                                            
                                                            
                                                    </div>
                                                    
                                                    <div class="col-6">

                                                            <!-- Fecha/Hora de Arribo -->
                                                            <div class="form-group">
                                                                <label class="text-gray" translate>claseDateTime.fechaHora <span translate>moduloRutas.arribo</span><span class="required">*</span></label>
                                                                <input formControlName="fechaHoraArriboReal"  id="fechaHoraArriboReal"                                                                 value="xx"
                                                                class="form-control" readonly>
                                                            </div>                                                            

                                                            <!-- Fecha/Hora de Finalización -->
                                                            <div class="form-group">
                                                                <label class="text-gray" translate>claseDateTime.fechaHora <span translate>moduloRutas.finalizacion</span><span class="required">*</span></label>
                                                                <input formControlName="fechaHoraFinalizacionReal"  id="fechaHoraFinalizacionReal"                                                                 value="xx"
                                                                class="form-control" readonly>
                                                            </div>                                                            
                                                            
                                                    </div>
                                                        
                                                </div>        


                                            </div> <!-- FIN card-body -->
                                        </div> <!-- FIN widget -->

                                        <!-- ********* Ubicación Actual del Vehículo ********** -->
                                        <div widget class="card border-0 box-shadow" style="margin-top:10px;">
                                            <div class="card-header transparent border-0 text-muted">
                                                <h5 class="mb-0" translate>Ubicación Actual del Vehículo</h5>
                                                <div class="widget-controls"> 
                                                     <a data-widgster="expand" href="#" class="transition"><i class="fa fa-chevron-down"></i></a>
                                                    <a data-widgster="collapse" href="#" class="transition"><i class="fa fa-chevron-up"></i></a>                                     
                                                </div>        
                                            </div>
                                            <div class="card-body pt-0 widget-body"> 
                                        
                                                    <div style="margin-top:10px;" formGroupName="vehiculoGeoPoint">
                                                        <div class="row">
                                                            <div class="col-6">
                                        
                                                                 <div class="form-group">
                                                                    <label class="text-gray" translate>claseGeoPoint.latitud<span class="required">*</span></label>
                                                                    <input formControlName="latitud" class="form-control validation-field" type="number"
                                                                           [disabled]="['Desarrollador','Supervisor','Distribuidor'].indexOf(tipoPerfilUsuario)==-1">
                                                                </div>
                                                            </div>    
                                                            <div class="col-6">
                                                                <div class="form-group">
                                                                    <label class="text-gray" translate>claseGeoPoint.longitud<span class="required">*</span></label>
                                                                    <input formControlName="longitud" class="form-control validation-field" type="number"
                                                                           [disabled]="['Desarrollador','Supervisor','Distribuidor'].indexOf(tipoPerfilUsuario)==-1">
                                                                 </div>                           
                                                            </div>    
                                                        </div>
                                        
                                                    </div>
                                            </div> <!-- FIN card-body -->
                                        </div> <!-- FIN widget -->
                                                                        
                                        
                                        <!-- settings   -->
                                        <br>
                                        <lib-shared-form-settings *ngIf="accionForm!='agregar'"
                                            [nameField]="'settings'" 
                                            [controlsField]="form.controls.settings"
                                            [value]="form.value.settings"
                                            [accionForm]="accionForm" 
                                            [formInvalid]="formInvalid" 
                                            [tipoPerfilUsuario]="tipoPerfilUsuario" 
                                            (cargoSubEstructura)="emitCargoSubEstructura($event)"></lib-shared-form-settings>
                                        
                                        <br>
                                        <lib-shared-form-buttons [accionForm]='accionForm' 
                                                          [permisos]='permisos' 
                                                          (setAccion)="setAccionForm($event)"
                                                          (onSubmitComponent)="onSubmit(form.value)"></lib-shared-form-buttons>

                                </form>    

                        </div>
                        
                        <!-- Resumen de Paradas, Integrantes y Vehículos -->
                        <div class="col-xl-3 mb-3" style="background:#e9ecef; border-left:1px solid #444;">
                                
                                <!-- Vehículos -->
                                <table class="table table-hover table-bordered table-condensed" style="margin-top:10px;">
                                    <thead>
                                        <tr style="background:#bdbec0; font-size:9px;"> 
                                            <th style="padding-top:5px; padding-bottom:5px;" colspan="2" translate>moduloRutas.vehiculo</th>
                                        </tr>    
                                    </thead>
                                    <tbody>
                                        <ng-container *ngFor="let opcion of listadoRutaVehiculos
                                                    | orderBy :'opcion.tipoVehiculoKN.key' :false :'case-insensitive'">                                                    
                                            <tr style="font-size:9px;">
                                                <td class="align-left text-left" style="padding-top:5px; padding-bottom:5px;"
                                                    (click)="forzarSolapa('Vehiculos',opcion,'consultar')">                                                 
                                                    {{opcion.vehiculo.nombre}} {{opcion.vehiculo.patente}}
                                                </td>    
                                                <td class="align-left text-center" style="padding-top:5px; padding-bottom:5px;" width="10%"
                                                    (click)="forzarSolapa('Vehiculos',opcion,'consultar')">                                                 
                                                    <i class="fa fa-check text-secondary" 
                                                       *ngIf="fn.mostrarKN(form.value.vehiculoPrincipalKN,'key')==opcion.vehiculo.key"></i>
                                                </td>    
                                            </tr>        
                                        </ng-container>   
                                                                                
                                    </tbody>
                                </table>                 

                                <!-- Integrantes -->
                                <table class="table table-hover table-bordered" style="margin-top:10px; font-size:9px;">
                                    <thead>
                                        <tr style="background:#bdbec0; font-size:9px;"> 
                                            <th style="padding-top:5px; padding-bottom:5px;" translate>moduloRutas.integrante</th>
                                            <th style="padding-top:5px; padding-bottom:5px;" class="text-center" translate>claseFicha.tipo</th>
                                        </tr>    
                                    </thead>
                                    <tbody>
                                        <ng-container *ngFor="let integrante of listadoRutaIntegrantes
                                                    | orderBy :'orden' :false :'case-insensitive'">                                                    
                                            <tr style="font-size:9px;">
                                                <td class="align-left text-left " style="padding-top:5px; padding-bottom:5px;"
                                                    (click)="forzarSolapa('Integrantes',integrante,'consultar')">                                                 
                                                    {{fn.mostrarKANE(integrante.usuarioKANE,'apellidoNombre')}}
                                                </td>    
                                                <td class="align-middle text-center" style="padding-top:5px; padding-bottom:5px;"
                                                    (click)="forzarSolapa('Integrantes',integrante,'consultar')">
                                                    {{fn.mostrarKN(integrante.tipoIntegranteKN,'nombre')}}
                                                </td>    
                                            </tr>        
                                        </ng-container>   
                                                                                
                                    </tbody>
                                </table>   
                                
                                <!-- Paradas -->
                                <div class="row" 
                                     style="margin-left:0px; margin-right:0px; margin-top:10px; height:20px; border:1px solic #ccc; background:#bdbec0; font-size:9px;">
                                   <div class="col-1" style="padding-left:10px; padding-right:5px; padding-top:3px;">
                                        <span style="font-weight:bold; color:black;">#</span>
                                   </div>                                    
                                    <div class="col-6" style="padding-left:10px; padding-right:5px; padding-top:3px;">
                                         <span style="font-weight:bold; color:black;">{{'moduloRutas.parada' | translate}}</span>
                                    </div>
                                    <div class="col-3" style="padding-left:5px; padding-right:5px; padding-top:3px;">
                                        <span style="font-weight:bold; color:black;"> {{'claseFicha.estado' | translate}}</span>                                        
                                    </div>     
                                    <div class="col-2" style="padding-left:5px; padding-right:5px; padding-top:3px;">
                                        <span style="font-weight:bold; color:black;">Kms</span>                                        
                                    </div>     
                                </div>    
                                <div [dragula]="'DRAGULA_EVENTS'" [(dragulaModel)]='paradasDragAndDrop'>
                                        <ng-container *ngFor="let documento of listadoRutaParadas
                                                    | orderBy :'documento.orden' :false :'case-insensitive';
                                                      let index=index">                                                    
                                            <div class="row" style="margin-left:0px; margin-right:0px; border:1px solid #ccc; font-size:9px;" id="parada{{index}}">
                                                <div class="col-1" style="padding-left:10px; padding-right:5px;" 
                                                     (click)="forzarSolapa('Paradas',documento,'consultar')">
                                                    {{documento.orden}}
                                               </div>                                                
                                                <div class="col-6" style="padding-left:10px; padding-right:5px;" 
                                                     (click)="forzarSolapa('Paradas',documento,'consultar')">
                                                    <span class="align-middle" style="color:#666; font-weight:bold;">{{documento.ubicacion.nombre}}</span><br>
                                                    {{fn.mostrarKN(documento.tipoParada,'nombre')}}
                                               </div>
                                               <div class="col-3" style="padding-left:5px; padding-right:5px;" 
                                                    (click)="forzarSolapa('Paradas',documento,'consultar')">
                                                    <span class="align-middle" style="color:#666; font-weight:bold;" translate>{{fn.mostrarKN(documento.estadoParadaKN,'nombre')}}</span><br>
                                                    {{documento.fechaHoraInicioPlaneada | date:'HH:MM hs':activeLang}}
                                                </div>     
                                                
                                               <div class="col-2 text-right" style="padding-left:5px; padding-right:5px;" 
                                                    (click)="forzarSolapa('Paradas',documento,'consultar')">
                                                    {{kmDistanciaDireccionAnterior(index) | number : '1.2-2'}} 
                                                </div>                                                     
                                           </div>    
                                        </ng-container>    
                                </div>                                                                           
                                
                                 <!-- Totales-->
                                 <div class="row" style="margin-left:0px; margin-right:0px; border:1px solid #ccc; font-size:9px;">
                                    <div class="col-7" style="padding-left:10px; padding-right:5px;">
                                    </div>
                                    <div class="col-3" style="padding-left:5px; padding-right:5px;">
                                    </div>     
                                    
                                    <div class="col-2 text-right" style="padding-left:5px; padding-right:5px;">
                                        {{form.value.distanciaPlanificada}} 
                                    </div>                                         
                               </div>    
                               
                        </div>
                            
                    </div> <!-- fin row division-->
                    
                </div> <!-- FIN tab-pane id="ta" -->

                <div class="tab-pane" id="panelVehiculos">
                    <app-rutas-vehiculos 
                        [ruta]="formatearDocumentoconForm(this.form.value,'vehiculos')"
                        [permisos]="permisos"
                        [accionInicial]="componenteVehiculosAccionInicial"
                        [documentoInicial]="componenteVehiculosDocumentoInicial"
                        (actualizarRutaconComponente)="actualizarRutaconComponente($event)">                        
                    </app-rutas-vehiculos>
                </div>

                <div class="tab-pane" id="panelIntegrantes">
                    <app-rutas-integrantes
                        [ruta]="formatearDocumentoconForm(this.form.value,'integrantes')"
                        [permisos]="permisos"
                        [accionInicial]="componenteIntegrantesAccionInicial"
                        [documentoInicial]="componenteIntegrantesDocumentoInicial"
                        (actualizarRutaconComponente)="actualizarRutaconComponente($event)">                        
                    </app-rutas-integrantes>
                </div>

                <div class="tab-pane" id="panelParadas">
                    <app-rutas-paradas                    
                        [ruta]="formatearDocumentoconForm(this.form.value,'paradas')"
                        [permisos]="permisos"
                        [accionInicial]="componenteParadasAccionInicial"
                        [documentoInicial]="componenteParadasDocumentoInicial"
                        (actualizarRutaconComponente)="actualizarRutaconComponente($event)">                        
                    </app-rutas-paradas>
                </div>

                <div class="tab-pane" id="panelRecorrido">
                    
                        <!-- Dibujo de la Ruta en Mapa -->
                        <div id="mapRuta{{dif}}" 
                             style="width:100%;" 
                             [ngStyle]="{height: heightMapa}"></div>                                                               

                </div>
                
            </div>                   

        </div>
    </div>

</div>
